<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laserscribed Architecture Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        header {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 50%, #c2410c 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            margin: -20px -20px 40px -20px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        h2 {
            color: #f97316;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #f97316;
            font-size: 1.8em;
        }

        h3 {
            color: #c2410c;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        h4 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        .diagram-container {
            background: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
        }

        .diagram-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #f97316;
            margin-bottom: 15px;
        }

        svg {
            max-width: 100%;
            height: auto;
        }

        .component-box {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .component-box:hover {
            opacity: 0.8;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
        }

        pre code {
            background: transparent;
            color: #f8f8f2;
            padding: 0;
        }

        .highlight {
            background: #fff7ed;
            padding: 15px;
            border-left: 4px solid #f97316;
            margin: 20px 0;
            border-radius: 4px;
        }

        .note {
            background: #d1ecf1;
            padding: 15px;
            border-left: 4px solid #17a2b8;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning {
            background: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 20px 0;
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background: #f97316;
            color: white;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        .toc {
            background: #fff7ed;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
        }

        .toc h3 {
            margin-top: 0;
            color: #f97316;
        }

        .toc ul {
            list-style: none;
            margin-left: 0;
        }

        .toc a {
            color: #f97316;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Laserscribed Architecture Guide</h1>
            <p style="font-size: 1.2em; margin-top: 10px;">A Complete Guide to React, Go, MySQL, sqlc, NGINX, and GitHub</p>
        </header>

        <section id="introduction">
            <h2>Introduction</h2>
            <p><strong>Laserscribed</strong> is a centralized web-based community hub for laser engraving professionals and hobbyists. Its flagship application, <strong>PowerScale</strong>, is a crowd-sourced, vote-validated database of laser material settings. This guide explains how each component of the full-stack application fits together and how data flows from the user's browser to the database and back.</p>

            <div class="highlight">
                <strong>What is PowerScale?</strong> Currently, laser settings are fragmented across Facebook groups, Reddit, and static spreadsheets. PowerScale solves this by providing a unified, searchable platform where users can discover, validate, and share machine-specific settings. The system uniquely bridges the gap between web applications and desktop software by natively importing and exporting <strong>LightBurn (.clb)</strong> XML library files.
            </div>
        </section>

        <div class="toc">
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#system-overview">System Overview</a></li>
                <li><a href="#core-features">Core Features</a></li>
                <li><a href="#components">The Components Explained</a></li>
                <li><a href="#pages">Pages and User Flow</a></li>
                <li><a href="#data-flow">How It All Works Together</a></li>
                <li><a href="#database">Database Architecture</a></li>
                <li><a href="#development">Development Workflow</a></li>
                <li><a href="#troubleshooting">Common Issues and Solutions</a></li>
            </ul>
        </div>

        <section id="system-overview">
            <h2>System Overview</h2>
            <p>Here's how all the components connect in the Laserscribed application:</p>

            <div class="diagram-container">
                <div class="diagram-title">Complete System Architecture</div>
                <svg viewBox="0 0 800 900" xmlns="http://www.w3.org/2000/svg">
                    <!-- User/Browser -->
                    <g class="component-box">
                        <rect x="300" y="20" width="200" height="80" fill="#f97316" rx="5" stroke="#ea580c" stroke-width="2"></rect>
                        <text x="400" y="50" text-anchor="middle" fill="white" font-size="16" font-weight="bold">User's Browser</text>
                        <text x="400" y="70" text-anchor="middle" fill="white" font-size="14">React Application</text>
                        <text x="400" y="88" text-anchor="middle" fill="white" font-size="12">Runs Client-Side</text>
                    </g>

                    <!-- Arrow to NGINX -->
                    <path d="M 400 100 L 400 160" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"></path>
                    <text x="420" y="135" font-size="12" fill="#666">HTTPS Request</text>

                    <!-- NGINX -->
                    <g class="component-box">
                        <rect x="300" y="160" width="200" height="80" fill="#009688" rx="5" stroke="#00695C" stroke-width="2"></rect>
                        <text x="400" y="190" text-anchor="middle" fill="white" font-size="16" font-weight="bold">NGINX</text>
                        <text x="400" y="210" text-anchor="middle" fill="white" font-size="14">Reverse Proxy</text>
                        <text x="400" y="228" text-anchor="middle" fill="white" font-size="12">Routes Traffic + SSL</text>
                    </g>

                    <!-- Arrow to Go Backend -->
                    <path d="M 500 200 L 580 200 L 580 320 L 500 320" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"></path>
                    <text x="590" y="265" font-size="12" fill="#666">/api/* requests</text>

                    <!-- Arrow to Static Files -->
                    <path d="M 300 200 L 220 200 L 220 320 L 300 320" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"></path>
                    <text x="120" y="265" font-size="12" fill="#666">Static files (HTML/JS/CSS)</text>

                    <!-- Go Backend -->
                    <g class="component-box">
                        <rect x="300" y="320" width="200" height="100" fill="#00BCD4" rx="5" stroke="#0097A7" stroke-width="2"></rect>
                        <text x="400" y="350" text-anchor="middle" fill="white" font-size="16" font-weight="bold">Go Backend (Gin)</text>
                        <text x="400" y="370" text-anchor="middle" fill="white" font-size="14">REST API Server</text>
                        <text x="400" y="388" text-anchor="middle" fill="white" font-size="12">Port 8080 | JWT Auth</text>
                        <text x="400" y="408" text-anchor="middle" fill="white" font-size="12">.clb Export Engine</text>
                    </g>

                    <!-- Arrow to sqlc -->
                    <path d="M 400 420 L 400 480" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"></path>
                    <text x="420" y="455" font-size="12" fill="#666">Type-safe queries</text>

                    <!-- sqlc Layer -->
                    <g class="component-box">
                        <rect x="300" y="480" width="200" height="80" fill="#FF9800" rx="5" stroke="#F57C00" stroke-width="2"></rect>
                        <text x="400" y="510" text-anchor="middle" fill="white" font-size="16" font-weight="bold">sqlc</text>
                        <text x="400" y="530" text-anchor="middle" fill="white" font-size="14">Query Generator</text>
                        <text x="400" y="548" text-anchor="middle" fill="white" font-size="12">Type-safe Database Access</text>
                    </g>

                    <!-- Arrow to MySQL -->
                    <path d="M 400 560 L 400 620" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"></path>
                    <text x="420" y="595" font-size="12" fill="#666">SQL queries</text>

                    <!-- MySQL Database -->
                    <g class="component-box">
                        <rect x="300" y="620" width="200" height="100" fill="#3F51B5" rx="5" stroke="#303F9F" stroke-width="2"></rect>
                        <text x="400" y="650" text-anchor="middle" fill="white" font-size="16" font-weight="bold">MySQL Database</text>
                        <text x="400" y="670" text-anchor="middle" fill="white" font-size="14">Persistent Storage</text>
                        <text x="400" y="688" text-anchor="middle" fill="white" font-size="12">Settings, Votes, Users</text>
                        <text x="400" y="706" text-anchor="middle" fill="white" font-size="12">Materials</text>
                    </g>

                    <!-- GitHub -->
                    <g class="component-box">
                        <rect x="50" y="400" width="180" height="80" fill="#24292e" rx="5" stroke="#000" stroke-width="2"></rect>
                        <text x="140" y="430" text-anchor="middle" fill="white" font-size="16" font-weight="bold">GitHub</text>
                        <text x="140" y="450" text-anchor="middle" fill="white" font-size="14">Source Control</text>
                        <text x="140" y="468" text-anchor="middle" fill="white" font-size="12">Version Management</text>
                    </g>

                    <!-- Arrow from GitHub to Go -->
                    <path d="M 230 440 L 300 380" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"></path>
                    <text x="240" y="405" font-size="12" fill="#666">Code Push/Pull</text>

                    <!-- AWS/Server Container -->
                    <rect x="270" y="140" width="260" height="600" fill="none" stroke="#f97316" stroke-width="3" stroke-dasharray="10,5" rx="10"></rect>
                    <text x="400" y="750" text-anchor="middle" fill="#f97316" font-size="14" font-weight="bold">Production Server (AWS Lightsail)</text>

                    <!-- Node.js (Development Only) -->
                    <g class="component-box">
                        <rect x="570" y="400" width="180" height="80" fill="#68A063" rx="5" stroke="#3C6E3C" stroke-width="2"></rect>
                        <text x="660" y="425" text-anchor="middle" fill="white" font-size="16" font-weight="bold">Node.js</text>
                        <text x="660" y="445" text-anchor="middle" fill="white" font-size="14">Build Tool (Vite)</text>
                        <text x="660" y="463" text-anchor="middle" fill="white" font-size="12" font-style="italic">Development Only</text>
                    </g>

                    <!-- Arrow markers -->
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#333"></polygon>
                        </marker>
                    </defs>

                    <!-- Legend -->
                    <g transform="translate(50, 780)">
                        <text x="0" y="0" font-size="14" font-weight="bold" fill="#333">Legend:</text>
                        <rect x="0" y="10" width="20" height="20" fill="#f97316" rx="2"></rect>
                        <text x="25" y="25" font-size="12" fill="#666">Frontend (Client)</text>
                        <rect x="150" y="10" width="20" height="20" fill="#00BCD4" rx="2"></rect>
                        <text x="175" y="25" font-size="12" fill="#666">Backend (Server)</text>
                        <rect x="300" y="10" width="20" height="20" fill="#3F51B5" rx="2"></rect>
                        <text x="325" y="25" font-size="12" fill="#666">Database</text>
                        <rect x="450" y="10" width="20" height="20" fill="#009688" rx="2"></rect>
                        <text x="475" y="25" font-size="12" fill="#666">Infrastructure</text>
                    </g>
                </svg>
            </div>

            <h3>Technology Stack</h3>
            <table>
                <thead>
                    <tr><th>Layer</th><th>Technology</th><th>Purpose</th></tr>
                </thead>
                <tbody>
                    <tr><td>Frontend</td><td>React (Vite)</td><td>User interface, .clb file parsing</td></tr>
                    <tr><td>Styling</td><td>Tailwind CSS v4</td><td>Utility-first CSS with custom dark theme</td></tr>
                    <tr><td>Server State</td><td>TanStack Query</td><td>Data fetching, caching, synchronization</td></tr>
                    <tr><td>Client State</td><td>React Context</td><td>Cart/checkout state for .clb export</td></tr>
                    <tr><td>Backend</td><td>Go (Gin)</td><td>REST API, .clb generation, business logic</td></tr>
                    <tr><td>Database</td><td>MySQL</td><td>Persistent storage via sqlc</td></tr>
                    <tr><td>Authentication</td><td>JWT</td><td>HTTP-only cookies, bcrypt password hashing</td></tr>
                </tbody>
            </table>
        </section>

        <section id="core-features">
            <h2>Core Features</h2>

            <h3>1. In-Browser .clb Parsing</h3>
            <p>Users can drag-and-drop LightBurn library files (.clb). The React frontend locally parses the XML, extracts the settings, and stages them for bulk upload — eliminating manual data entry.</p>

            <h3>2. "Add to Cart" LightBurn Export</h3>
            <p>Instead of downloading individual settings, users select multiple settings across different materials using checkboxes. A persistent "Checkout" bar aggregates these selections and triggers the Go backend to dynamically generate a single, unified .clb file for download.</p>

            <h3>3. Faceted Data Discovery</h3>
            <p>High-performance filtering allowing users to cross-reference settings by <strong>Material</strong>, <strong>Laser Type</strong> (Diode, CO2, Fiber, UV), <strong>Wattage</strong>, and <strong>Type of Marking</strong> (Line, Fill, 3D Engrave, Image).</p>

            <h3>4. Community Validation (Voting)</h3>
            <p>A gamified upvote/downvote system tied to authenticated user profiles ensures the most reliable settings rise to the top of the search results.</p>

            <h3>5. Material Normalization</h3>
            <p>Backend logic maps user-submitted material names (e.g., "3mm Plywood", "Birch 1/8") to a standardized canonical taxonomy to prevent database fragmentation.</p>
        </section>

        <section id="components">
            <h2>The Components Explained</h2>

            <h3>1. React Frontend (The User Interface)</h3>
            <p><strong>What it is:</strong> React is a JavaScript library for building user interfaces. It creates the web pages that users see and interact with in their browser.</p>

            <p><strong>What it does in Laserscribed:</strong></p>
            <ul>
                <li>Displays the PowerScale search interface with faceted filters (Material, Laser Type, Wattage, Marking Type)</li>
                <li>Renders settings results table with checkboxes for .clb export selection</li>
                <li>Opens detail modals mimicking LightBurn's "Cut Settings Editor"</li>
                <li>Parses .clb XML files client-side for bulk import</li>
                <li>Manages cart/checkout state via React Context</li>
                <li>Handles user interactions (voting, contributing settings, authentication)</li>
                <li>Makes requests to the backend API using TanStack Query for caching and state management</li>
                <li>Provides a responsive dark-themed UI</li>
            </ul>

            <p><strong>Key technologies:</strong></p>
            <ul>
                <li><strong>Vite</strong> — Lightning-fast build tool and dev server</li>
                <li><strong>Tailwind CSS v4</strong> — Utility-first styling with custom theme colors</li>
                <li><strong>TanStack Query</strong> — Data fetching, caching, and synchronization (server state)</li>
                <li><strong>React Context</strong> — Client-side state management (cart/checkout)</li>
                <li><strong>React Router</strong> — Client-side page navigation</li>
            </ul>

            <h3>2. Go Backend with Gin Framework (The API Server)</h3>
            <p><strong>What it is:</strong> Go is a programming language that runs on the server. The Laserscribed backend uses the Gin framework to create a REST API that the React frontend calls.</p>

            <p><strong>What it does:</strong></p>
            <ul>
                <li>Handles REST API endpoints for auth, settings, materials, votes, and .clb export</li>
                <li>Authenticates users with JWT tokens stored in HTTP-only cookies</li>
                <li>Hashes passwords with bcrypt</li>
                <li>Connects to MySQL using sqlc-generated type-safe code</li>
                <li>Accepts bulk setting uploads (JSON arrays) from .clb imports</li>
                <li>Generates LightBurn .clb XML files from selected settings</li>
                <li>Computes vote scores via SQL aggregation</li>
            </ul>

            <p><strong>API endpoints:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Endpoint</th>
                        <th>Description</th>
                        <th>Auth?</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>POST</td><td><code>/api/auth/register</code></td><td>Create user with bcrypt-hashed password</td><td>No</td></tr>
                    <tr><td>POST</td><td><code>/api/auth/login</code></td><td>Validate credentials, set HTTP-only JWT cookie</td><td>No</td></tr>
                    <tr><td>GET</td><td><code>/api/auth/me</code></td><td>Validate JWT cookie, return user profile</td><td>Yes</td></tr>
                    <tr><td>PUT</td><td><code>/api/auth/password</code></td><td>Update password (requires current password)</td><td>Yes</td></tr>
                    <tr><td>GET</td><td><code>/api/materials</code></td><td>Retrieve canonical material taxonomy</td><td>No</td></tr>
                    <tr><td>GET</td><td><code>/api/settings</code></td><td>Fetch settings with filters (?laser_type, ?wattage, ?marking_type, ?material)</td><td>No</td></tr>
                    <tr><td>POST</td><td><code>/api/settings</code></td><td>Accept JSON array (bulk) or object (single)</td><td>Yes</td></tr>
                    <tr><td>POST</td><td><code>/api/settings/{id}/vote</code></td><td>Cast upvote/downvote for a setting</td><td>Yes</td></tr>
                    <tr><td>POST</td><td><code>/api/export/lightburn</code></td><td>Accept setting IDs, return .clb XML file</td><td>No</td></tr>
                </tbody>
            </table>

            <h3>3. MySQL Database (Persistent Data Storage)</h3>
            <p><strong>What it is:</strong> MySQL is a relational database that stores all of Laserscribed's data in structured, related tables.</p>

            <p><strong>What it stores:</strong></p>
            <ul>
                <li><strong>Users</strong> — accounts, credentials, display names</li>
                <li><strong>Materials</strong> — canonical material taxonomy with name, thickness, and category</li>
                <li><strong>Material Settings</strong> — the core PowerScale data (laser type, wattage, marking type, speed, power, passes, interval, z-offset, air assist, cached vote score)</li>
                <li><strong>Votes</strong> — community validation (+1/-1 per user per setting)</li>
            </ul>

            <h3>4. sqlc (Type-Safe Query Generator)</h3>
            <p><strong>What it is:</strong> sqlc reads SQL queries and generates type-safe Go code. It ensures your Go code and database schema stay in sync at compile time.</p>

            <div class="note">
                <strong>Why sqlc?</strong> Instead of writing raw SQL strings in Go and manually mapping results to structs, sqlc automates this. If you rename a database column, your code won't compile until you fix all references — catching bugs before they hit production.
            </div>

            <p><strong>Example sqlc workflow:</strong></p>
            <pre><code>-- queries.sql: You write SQL with annotations
-- name: SearchSettings :many
SELECT ms.*, m.name as material_name, m.category,
       COALESCE(ms.votes_score, 0) as score
FROM material_settings ms
JOIN materials m ON ms.material_id = m.id
WHERE (sqlc.narg(laser_type) IS NULL
       OR ms.laser_type = sqlc.narg(laser_type))
  AND (sqlc.narg(machine_wattage) IS NULL
       OR ms.machine_wattage = sqlc.narg(machine_wattage))
  AND (sqlc.narg(marking_type) IS NULL
       OR ms.marking_type = sqlc.narg(marking_type))
ORDER BY score DESC;</code></pre>

            <pre><code>// sqlc generates type-safe Go code:
func (q *Queries) SearchSettings(ctx context.Context, arg SearchSettingsParams) ([]SearchSettingsRow, error)

// With a typed params struct:
type SearchSettingsParams struct {
    LaserType      sql.NullString
    MachineWattage sql.NullInt32
    MarkingType    sql.NullString
}</code></pre>

            <h3>5. Node.js / Vite (Build Tool)</h3>
            <p><strong>What it is:</strong> Node.js runs Vite, the build tool that bundles React code for production and provides the dev server with hot module replacement.</p>

            <div class="warning">
                <strong>IMPORTANT:</strong> Node.js runs during <em>development</em> and <em>build time</em> only. It does <strong>NOT</strong> run on your production server. Only the static files it creates are deployed.
            </div>

            <h3>6. NGINX (The Traffic Director)</h3>
            <p><strong>What it is:</strong> NGINX is a web server and reverse proxy that acts as the front door for the application.</p>

            <p><strong>What it does:</strong></p>
            <ul>
                <li>Receives ALL incoming requests from users' browsers</li>
                <li>Handles SSL/TLS certificates (HTTPS encryption via Let's Encrypt)</li>
                <li>Routes API requests (<code>/api/*</code>) to the Go backend on port 8080</li>
                <li>Serves React static files directly for page requests</li>
            </ul>

            <h3>7. GitHub (Source Control)</h3>
            <p><strong>What it provides:</strong></p>
            <ul>
                <li>Version control — track every change to the codebase</li>
                <li>Issue tracking — feature requests, bugs, and milestones</li>
                <li>CI/CD pipelines via GitHub Actions</li>
                <li>Backup of the entire codebase</li>
            </ul>
        </section>

        <section id="pages">
            <h2>Pages and User Flow</h2>

            <h3>A. The Dashboard / Search Hub (Home Page)</h3>
            <ul>
                <li><strong>Search Interface:</strong>
                    <ul>
                        <li>Material: Autocomplete text field (e.g., "Baltic Birch")</li>
                        <li>Type of Laser: Dropdown (Diode, CO2, Fiber, UV, Infrared)</li>
                        <li>Wattage: Dropdown (10W, 20W, 40W, 60W, 100W+)</li>
                        <li>Type of Marking: Dropdown (Line/Cut, Fill/Engrave, Offset Fill, Image, 3D Engrave/Sliced)</li>
                    </ul>
                </li>
                <li><strong>Results Table:</strong> Displays matching settings sorted by community upvotes. Each row includes a checkbox for selection.</li>
                <li><strong>Detail Modal:</strong> Clicking a row opens a modal mimicking LightBurn's "Cut Settings Editor" (Speed, Min/Max Power, Passes, Interval, Air Assist, etc.).</li>
                <li><strong>The "Checkout" Bar:</strong> A sticky footer that appears when items are checked. Displays the total selected items and a "Download .clb Library" button.</li>
            </ul>

            <h3>B. Authentication &amp; Profile</h3>
            <ul>
                <li><strong>Inline Login/Signup:</strong> A self-contained panel on the home page. Users log in with Email/Password.</li>
                <li><strong>Profile Management:</strong> Accessed via a top navigation dropdown. Allows users to change their password (requiring current password validation) and view a history of their contributed settings.</li>
            </ul>

            <h3>C. The Contribution Dashboard (/contribute)</h3>
            <p>A split-screen interface offering two paths:</p>
            <ul>
                <li><strong>Path 1: Bulk Import (The Staging Area):</strong> A dropzone for .clb files. Once dropped, a preview table appears. The user selects the Laser Type and Wattage globally for the imported list (since LightBurn .clb files don't store hardware info), then clicks "Publish to PowerScale."</li>
                <li><strong>Path 2: Manual Entry:</strong> A standard web form mirroring LightBurn inputs for users who only want to contribute a single setting.</li>
            </ul>
        </section>

        <section id="data-flow">
            <h2>How It All Works Together</h2>

            <div class="diagram-container">
                <div class="diagram-title">PowerScale Search Flow</div>
                <svg viewBox="0 0 900 700" xmlns="http://www.w3.org/2000/svg">
                    <!-- Flow Steps -->
                    <g>
                        <circle cx="100" cy="50" r="30" fill="#f97316" stroke="#ea580c" stroke-width="2"></circle>
                        <text x="100" y="55" text-anchor="middle" fill="white" font-size="20" font-weight="bold">1</text>
                        <text x="150" y="55" font-size="14">User selects material, laser type, wattage, marking type</text>
                    </g>
                    <path d="M 100 80 L 100 130" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"></path>

                    <g>
                        <circle cx="100" cy="150" r="30" fill="#009688" stroke="#00695C" stroke-width="2"></circle>
                        <text x="100" y="155" text-anchor="middle" fill="white" font-size="20" font-weight="bold">2</text>
                        <text x="150" y="155" font-size="14">NGINX receives request</text>
                    </g>

                    <path d="M 70 150 L 20 200 L 20 250" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"></path>
                    <text x="25" y="180" font-size="11" fill="#666">Static</text>
                    <g>
                        <circle cx="20" cy="270" r="20" fill="#FF9800" stroke="#F57C00" stroke-width="2"></circle>
                        <text x="20" y="275" text-anchor="middle" fill="white" font-size="16" font-weight="bold">3a</text>
                        <text x="50" y="275" font-size="12">Serve React files</text>
                    </g>

                    <path d="M 130 150 L 180 200 L 180 250" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"></path>
                    <text x="165" y="180" font-size="11" fill="#666">API</text>
                    <g>
                        <circle cx="180" cy="270" r="20" fill="#00BCD4" stroke="#0097A7" stroke-width="2"></circle>
                        <text x="180" y="275" text-anchor="middle" fill="white" font-size="16" font-weight="bold">3b</text>
                        <text x="210" y="275" font-size="12">Forward to Go backend</text>
                    </g>

                    <path d="M 180 290 L 180 340" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"></path>
                    <g>
                        <circle cx="180" cy="360" r="20" fill="#00BCD4" stroke="#0097A7" stroke-width="2"></circle>
                        <text x="180" y="365" text-anchor="middle" fill="white" font-size="16" font-weight="bold">4</text>
                        <text x="210" y="365" font-size="12">Go parses filter params + validates JWT</text>
                    </g>

                    <path d="M 180 380 L 180 430" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"></path>
                    <g>
                        <circle cx="180" cy="450" r="20" fill="#FF9800" stroke="#F57C00" stroke-width="2"></circle>
                        <text x="180" y="455" text-anchor="middle" fill="white" font-size="16" font-weight="bold">5</text>
                        <text x="210" y="455" font-size="12">Execute sqlc SearchSettings query</text>
                    </g>

                    <path d="M 180 470 L 180 520" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"></path>
                    <g>
                        <circle cx="180" cy="540" r="20" fill="#3F51B5" stroke="#303F9F" stroke-width="2"></circle>
                        <text x="180" y="545" text-anchor="middle" fill="white" font-size="16" font-weight="bold">6</text>
                        <text x="210" y="545" font-size="12">JOIN materials + vote aggregation</text>
                    </g>

                    <path d="M 200 540 L 250 540 L 250 360 L 200 360" stroke="#28a745" stroke-width="2" marker-end="url(#arrow-green)" stroke-dasharray="5,5"></path>
                    <text x="260" y="450" font-size="11" fill="#28a745">Returns ranked data</text>

                    <g>
                        <circle cx="180" cy="620" r="20" fill="#28a745" stroke="#1e7e34" stroke-width="2"></circle>
                        <text x="180" y="625" text-anchor="middle" fill="white" font-size="16" font-weight="bold">7</text>
                        <text x="210" y="625" font-size="12">JSON to React → render results table + checkboxes</text>
                    </g>
                    <path d="M 180 560 L 180 600" stroke="#28a745" stroke-width="2" marker-end="url(#arrow-green)" stroke-dasharray="5,5"></path>

                    <!-- Code Examples -->
                    <g transform="translate(350, 50)">
                        <text x="0" y="0" font-size="14" font-weight="bold" fill="#333">Example: Search Settings for CO2 60W Fill Engrave</text>

                        <rect x="0" y="10" width="500" height="220" fill="#f8f9fa" stroke="#ddd" stroke-width="1" rx="5"></rect>

                        <text x="10" y="30" font-size="12" fill="#666" font-weight="bold">1. React (SearchHub):</text>
                        <text x="10" y="48" font-size="11" font-family="monospace" fill="#333">fetch('/api/settings?laser_type=CO2&amp;wattage=60</text>
                        <text x="10" y="63" font-size="11" font-family="monospace" fill="#333">  &amp;marking_type=Fill').then(r =&gt; r.json())</text>

                        <text x="10" y="90" font-size="12" fill="#666" font-weight="bold">2. Go Backend (main.go):</text>
                        <text x="10" y="108" font-size="11" font-family="monospace" fill="#333">params.LaserType = sql.NullString{</text>
                        <text x="10" y="123" font-size="11" font-family="monospace" fill="#333">  String: "CO2", Valid: true}</text>
                        <text x="10" y="138" font-size="11" font-family="monospace" fill="#333">settings, _ := queries.SearchSettings(ctx, params)</text>

                        <text x="10" y="165" font-size="12" fill="#666" font-weight="bold">3. MySQL (via sqlc):</text>
                        <text x="10" y="183" font-size="11" font-family="monospace" fill="#333">SELECT ms.*, m.name, ms.votes_score as score</text>
                        <text x="10" y="198" font-size="11" font-family="monospace" fill="#333">FROM material_settings ms JOIN materials m ON ...</text>
                        <text x="10" y="213" font-size="11" font-family="monospace" fill="#333">WHERE ms.laser_type='CO2' ORDER BY score DESC</text>
                    </g>

                    <defs>
                        <marker id="arrow2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#333"></polygon>
                        </marker>
                        <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#28a745"></polygon>
                        </marker>
                    </defs>
                </svg>
            </div>

            <h3>Detailed Example: Loading the PowerScale Search Hub</h3>
            <ol>
                <li><strong>Browser requests:</strong> <code>https://laserscribed.com</code></li>
                <li><strong>NGINX receives request</strong>
                    <ul>
                        <li>Path is <code>/</code> (not <code>/api/*</code>)</li>
                        <li>Serves the React SPA: <code>index.html</code></li>
                    </ul>
                </li>
                <li><strong>Browser loads React app</strong>
                    <ul>
                        <li>React Router renders the Dashboard / Search Hub</li>
                        <li>TanStack Query fetches <code>/api/materials</code> for autocomplete</li>
                    </ul>
                </li>
                <li><strong>User selects filters</strong>
                    <ul>
                        <li>Types material name → autocomplete suggests canonical matches</li>
                        <li>Selects Laser Type, Wattage, Marking Type from dropdowns</li>
                        <li>TanStack Query fetches <code>/api/settings?laser_type=CO2&amp;wattage=60&amp;marking_type=Fill</code></li>
                    </ul>
                </li>
                <li><strong>Go backend processes request</strong>
                    <ul>
                        <li>Parses query params into SearchSettingsParams</li>
                        <li>Calls sqlc: JOIN materials table with optional WHERE clauses</li>
                        <li>MySQL returns rows sorted by cached votes_score</li>
                        <li>Go serializes to JSON</li>
                    </ul>
                </li>
                <li><strong>React renders results</strong>
                    <ul>
                        <li>Results table displays settings with checkboxes</li>
                        <li>Users can click rows for detail modal (LightBurn-style Cut Settings Editor)</li>
                        <li>Users can upvote/downvote (triggers POST to <code>/api/settings/:id/vote</code>)</li>
                        <li>Users can check settings for .clb export → sticky checkout bar appears</li>
                    </ul>
                </li>
            </ol>

            <h3>LightBurn .clb Import Flow</h3>
            <ol>
                <li><strong>User navigates to /contribute</strong> and selects "Bulk Import"</li>
                <li><strong>Drops .clb file</strong> into the dropzone</li>
                <li><strong>React parses XML client-side</strong> — extracts speed, power, passes, interval, material names</li>
                <li><strong>Preview table</strong> shows extracted settings</li>
                <li><strong>User selects Laser Type and Wattage</strong> globally (not in .clb files)</li>
                <li><strong>Clicks "Publish to PowerScale"</strong></li>
                <li><strong>POST /api/settings</strong> with JSON array body → backend inserts all settings</li>
            </ol>

            <h3>LightBurn .clb Export Flow</h3>
            <ol>
                <li><strong>User checks settings</strong> in the results table</li>
                <li><strong>Sticky checkout bar</strong> shows "3 items selected — Download .clb Library"</li>
                <li><strong>Click download</strong> → POST <code>/api/export/lightburn</code> with <code>{ setting_ids: [1, 2, 3] }</code></li>
                <li><strong>Go backend aggregates</strong> setting data and generates valid LightBurn XML</li>
                <li><strong>Browser downloads</strong> the .clb file</li>
            </ol>
        </section>

        <section id="database">
            <h2>Database Architecture</h2>

            <div class="diagram-container">
                <div class="diagram-title">Database Schema (4 Tables)</div>
                <svg viewBox="0 0 850 450" xmlns="http://www.w3.org/2000/svg">
                    <!-- Users -->
                    <g>
                        <rect x="30" y="30" width="200" height="130" fill="#FFF3E0" stroke="#F57C00" stroke-width="2" rx="5"></rect>
                        <rect x="30" y="30" width="200" height="25" fill="#F57C00" rx="5"></rect>
                        <text x="130" y="47" text-anchor="middle" fill="white" font-size="12" font-weight="bold">users</text>
                        <text x="40" y="70" font-size="10" font-weight="bold">id (PK, BIGINT)</text>
                        <text x="40" y="85" font-size="10">email (VARCHAR, Unique)</text>
                        <text x="40" y="100" font-size="10">password_hash (VARCHAR)</text>
                        <text x="40" y="115" font-size="10">display_name (VARCHAR)</text>
                        <text x="40" y="130" font-size="10">created_at (TIMESTAMP)</text>
                    </g>

                    <!-- Materials -->
                    <g>
                        <rect x="30" y="220" width="200" height="120" fill="#E8F5E9" stroke="#388E3C" stroke-width="2" rx="5"></rect>
                        <rect x="30" y="220" width="200" height="25" fill="#388E3C" rx="5"></rect>
                        <text x="130" y="237" text-anchor="middle" fill="white" font-size="12" font-weight="bold">materials</text>
                        <text x="40" y="260" font-size="10" font-weight="bold">id (PK, BIGINT)</text>
                        <text x="40" y="275" font-size="10">name (VARCHAR)</text>
                        <text x="40" y="290" font-size="10">thickness_mm (DECIMAL)</text>
                        <text x="40" y="305" font-size="10">category (VARCHAR)</text>
                    </g>

                    <!-- Material Settings (center) -->
                    <g>
                        <rect x="310" y="50" width="280" height="310" fill="#FFEBEE" stroke="#D32F2F" stroke-width="3" rx="5"></rect>
                        <rect x="310" y="50" width="280" height="25" fill="#D32F2F" rx="5"></rect>
                        <text x="450" y="67" text-anchor="middle" fill="white" font-size="13" font-weight="bold">material_settings (PowerScale)</text>
                        <text x="320" y="90" font-size="10" font-weight="bold">id (PK, BIGINT)</text>
                        <text x="320" y="105" font-size="10" font-weight="bold">user_id (FK → users)</text>
                        <text x="320" y="120" font-size="10" font-weight="bold">material_id (FK → materials)</text>
                        <text x="320" y="140" font-size="10">laser_type (ENUM: Diode, CO2, Fiber, UV, Infrared)</text>
                        <text x="320" y="155" font-size="10">machine_wattage (INT)</text>
                        <text x="320" y="170" font-size="10">marking_type (ENUM: Line, Fill, Offset Fill, Image, 3D Engrave)</text>
                        <text x="320" y="190" font-size="10">speed (DECIMAL, mm/sec)</text>
                        <text x="320" y="205" font-size="10">min_power (DECIMAL)</text>
                        <text x="320" y="220" font-size="10">max_power (DECIMAL)</text>
                        <text x="320" y="235" font-size="10">passes (INT)</text>
                        <text x="320" y="250" font-size="10">interval_mm (DECIMAL)</text>
                        <text x="320" y="265" font-size="10">z_offset (DECIMAL)</text>
                        <text x="320" y="280" font-size="10">air_assist (BOOLEAN)</text>
                        <text x="320" y="295" font-size="10">votes_score (INT, cached aggregate)</text>
                        <text x="320" y="310" font-size="10">created_at (TIMESTAMP)</text>
                    </g>

                    <!-- Votes -->
                    <g>
                        <rect x="660" y="100" width="160" height="130" fill="#FFF8E1" stroke="#FFA000" stroke-width="2" rx="5"></rect>
                        <rect x="660" y="100" width="160" height="25" fill="#FFA000" rx="5"></rect>
                        <text x="740" y="117" text-anchor="middle" fill="white" font-size="12" font-weight="bold">votes</text>
                        <text x="670" y="140" font-size="10" font-weight="bold">id (PK, BIGINT)</text>
                        <text x="670" y="155" font-size="10" font-weight="bold">user_id (FK → users)</text>
                        <text x="670" y="170" font-size="10" font-weight="bold">setting_id (FK → material_settings)</text>
                        <text x="670" y="185" font-size="10">vote_value (INT: +1 or -1)</text>
                        <text x="670" y="205" font-size="9" fill="#888">UNIQUE(user_id, setting_id)</text>
                    </g>

                    <!-- FK arrows -->
                    <path d="M 230 95 L 310 95" stroke="#D32F2F" stroke-width="1.5" fill="none" marker-end="url(#fk-arrow-red)"></path>
                    <path d="M 230 280 L 310 135" stroke="#D32F2F" stroke-width="1.5" fill="none" marker-end="url(#fk-arrow-red)"></path>
                    <path d="M 590 165 L 660 165" stroke="#FFA000" stroke-width="1.5" fill="none" marker-end="url(#fk-arrow)"></path>

                    <defs>
                        <marker id="fk-arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#333"></polygon>
                        </marker>
                        <marker id="fk-arrow-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#D32F2F"></polygon>
                        </marker>
                    </defs>
                </svg>
            </div>

            <p><strong>Database tables:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>Table</th>
                        <th>Purpose</th>
                        <th>Key Fields</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><strong>users</strong></td><td>User accounts and auth</td><td>id, email (unique), password_hash, display_name, created_at</td></tr>
                    <tr><td><strong>materials</strong></td><td>Canonical material taxonomy</td><td>id, name, thickness_mm, category (Wood, Acrylic, Metal, etc.)</td></tr>
                    <tr><td><strong>material_settings</strong></td><td>Core PowerScale data</td><td>id, user_id (FK), material_id (FK), laser_type (ENUM), machine_wattage, marking_type (ENUM), speed, min_power, max_power, passes, interval_mm, z_offset, air_assist, votes_score</td></tr>
                    <tr><td><strong>votes</strong></td><td>Community validation</td><td>id, user_id (FK), setting_id (FK), vote_value (+1/-1)</td></tr>
                </tbody>
            </table>

            <h3>Key Relationships</h3>
            <ul>
                <li><strong>material_settings</strong> is the central table — it references users and materials, with ENUM fields for laser_type and marking_type</li>
                <li><strong>votes</strong> link users to settings with a unique constraint (one vote per user per setting)</li>
                <li><strong>votes_score</strong> is a cached aggregate on material_settings for fast sorting</li>
                <li><strong>materials</strong> provide a canonical taxonomy — material normalization maps user submissions to standardized entries</li>
            </ul>
        </section>

        <section id="development">
            <h2>Development Workflow</h2>

            <h3>Local Development Setup</h3>
            <ol>
                <li><strong>Database setup:</strong>
                    <pre><code>mysql -u root < backend/schema.sql
mysql -u root < backend/sample_data.sql</code></pre>
                </li>
                <li><strong>Start backend:</strong>
                    <pre><code>cd backend
go run main.go    # Runs on localhost:8080</code></pre>
                </li>
                <li><strong>Start frontend:</strong>
                    <pre><code>cd frontend
npm install       # First time only
npm run dev       # Runs on localhost:5173</code></pre>
                </li>
                <li><strong>Vite proxy:</strong> Requests to <code>/api/*</code> on port 5173 are automatically proxied to Go on port 8080</li>
            </ol>

            <h3>Making Changes</h3>
            <ul>
                <li><strong>React changes:</strong> Hot-reloaded automatically by Vite</li>
                <li><strong>Go changes:</strong> Requires restart (or use <code>air</code> for auto-reload)</li>
                <li><strong>Database schema changes:</strong> Edit <code>schema.sql</code>, re-run sqlc: <code>sqlc generate</code></li>
                <li><strong>New queries:</strong> Add to <code>db/queries.sql</code>, run <code>sqlc generate</code>, use in <code>main.go</code></li>
            </ul>

            <h3>Production Deployment</h3>
            <ol>
                <li><code>npm run build</code> — Creates optimized static files in <code>dist/</code></li>
                <li><code>go build -o server</code> — Compiles Go binary</li>
                <li><code>git push</code> — Push to GitHub</li>
                <li>Deploy to AWS Lightsail server, configure NGINX, restart services</li>
            </ol>
        </section>

        <section id="troubleshooting">
            <h2>Common Issues and Solutions</h2>

            <h3>Database Connection Errors</h3>
            <div class="warning">
                <strong>Problem:</strong> "Failed to connect to database" or "Access denied"
                <br><br>
                <strong>Solution:</strong>
                <ul>
                    <li>Check MySQL is running: <code>systemctl status mysql</code></li>
                    <li>Verify connection string in <code>main.go</code></li>
                    <li>Test connection: <code>mysql -u laserscribe -p</code></li>
                    <li>Create database if missing: run <code>schema.sql</code></li>
                </ul>
            </div>

            <h3>CORS Errors</h3>
            <div class="warning">
                <strong>Problem:</strong> "Access blocked by CORS policy"
                <br><br>
                <strong>Why:</strong> React (port 5173) and Go (port 8080) are different origins. The Vite proxy config handles this in development. In production, NGINX proxies everything through one origin.
            </div>

            <h3>sqlc Generation Errors</h3>
            <div class="warning">
                <strong>Problem:</strong> <code>sqlc generate</code> fails
                <br><br>
                <strong>Solution:</strong>
                <ul>
                    <li>Test queries directly in MySQL first</li>
                    <li>Check query annotations (<code>-- name: ...</code>) syntax</li>
                    <li>Verify <code>schema.sql</code> matches your queries</li>
                    <li>Review sqlc error messages — they're usually specific</li>
                </ul>
            </div>

            <h3>JWT / Authentication Errors</h3>
            <div class="warning">
                <strong>Problem:</strong> "Unauthorized" responses on protected endpoints
                <br><br>
                <strong>Solution:</strong>
                <ul>
                    <li>Check JWT cookie is being set (browser DevTools → Application → Cookies)</li>
                    <li>Verify JWT secret is consistent between token creation and validation</li>
                    <li>Check cookie path and domain settings</li>
                    <li>Ensure <code>credentials: 'include'</code> is set on fetch requests</li>
                </ul>
            </div>

            <h3>Empty API Responses</h3>
            <div class="warning">
                <strong>Problem:</strong> API returns 200 OK but empty data
                <br><br>
                <strong>Solution:</strong>
                <ul>
                    <li>Check if seed data was loaded: <code>SELECT COUNT(*) FROM material_settings;</code></li>
                    <li>Verify filter params are being parsed correctly in Go</li>
                    <li>Check <code>sql.NullString</code> / <code>sql.NullInt32</code> Valid flags</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>Key Takeaways</h2>
            <ul>
                <li><strong>Separation of Concerns:</strong> React handles UI + .clb parsing, Go handles API logic + .clb generation, MySQL stores data, sqlc bridges Go and MySQL, NGINX routes traffic</li>
                <li><strong>LightBurn Integration:</strong> Native .clb import/export bridges web and desktop laser software workflows</li>
                <li><strong>Vote-Driven Ranking:</strong> Cached votes_score on material_settings enables fast sorting without JOIN aggregation on every query</li>
                <li><strong>Faceted Discovery:</strong> ENUM-based filtering (laser_type, marking_type) with optional WHERE clauses via sqlc.narg</li>
                <li><strong>Type Safety:</strong> sqlc ensures Go code and database schema stay in sync at compile time</li>
                <li><strong>JWT Security:</strong> HTTP-only cookies prevent XSS token theft; bcrypt secures passwords</li>
                <li><strong>API-First Design:</strong> Well-defined REST endpoints enable future clients (mobile app, CLI tool, etc.)</li>
            </ul>
        </section>

        <footer style="margin-top: 60px; padding: 20px; background: #fff7ed; text-align: center; border-top: 3px solid #f97316;">
            <p style="margin: 0; color: #666;">Created for the Laserscribed / PowerScale Project</p>
            <p style="margin: 5px 0 0 0; color: #999; font-size: 0.9em;">React + Vite + Tailwind v4 + Go + Gin + sqlc + MySQL + JWT</p>
        </footer>
    </div>
</body></html>
